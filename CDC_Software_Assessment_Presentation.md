# 宏基因组病毒检测工具评估报告
## CDC专家汇报演示文稿

**作者**: Sihua Peng  
**评估环境**: UGA Sapelo2 (HPC 集群)  
**日期**: 2025-12-15

---

## Slide 1: 标题页

# 宏基因组病毒检测工具评估报告

**向CDC国家废水监测系统（NWSS）技术审查委员会汇报**

- **评估对象**: CDC清单10项软件 + 3项自研工作流
- **评估环境**: UGA Sapelo2 HPC集群（无sudo限制）
- **核心目标**: 工程可落地 + 科学可解释

**Sihua Peng**  
2025年12月15日

---

## Slide 2: 评估背景与目标

### CDC评估任务

**评估清单**: 10项软件/平台

**评估重点**:
- ✅ **可部署性与可复现性**（无sudo集群部署）
- ✅ **核心算法与依赖生态**
- ✅ **短读长/长读长兼容性**
- ✅ **结果解释与假阳性风险**

**评估原则**:
- 默认输出 vs 共识/阈值输出
- 避免"既最敏感又最特异"的矛盾结论

---

## Slide 3: 评估结果概览

### 评估完成情况

| 类别 | 数量 | 状态 |
|:---|:---:|:---|
| **CDC清单内可运行** | 5 | ✅ 深度评估 |
| **CDC清单内不可运行** | 5 | ❌ 记录原因 |
| **作者自研工作流** | 3 | ✅ 深度评估 |
| **总计深度评估** | **8** | ✅ |

**关键发现**: 可部署性是工具选型的关键门槛

---

## Slide 4: 深度评估的8个工具

### CDC清单内（5个）

1. **nf-core/taxprofiler** - 多分类器并行流程
2. **GOTTCHA2** - 高特异性签名分类
3. **sourmash** - MinHash快速检索
4. **CLARK** - 判别性k-mer分类
5. **nf-core/mag** - 宏基因组组装与分箱

### 作者自研（3个）

6. **rvdb-viral-metagenome-nf** - 病毒发现流程
7. **MLMVD-nf** - 多工具共识筛选
8. **KrakenMetaReads-nf** - 先组装后分类

---

## Slide 5: 测试数据集

### 评估使用的数据

**短读长数据（Illumina）**:
- `llnl_66ce4dde_R1.fastq.gz` (670.52 MB)
- `llnl_66ce4dde_R2.fastq.gz` (693.43 MB)

**长读长数据（ONT/PacBio类）**:
- `llnl_66d1047e.fastq.gz` (263.93 MB)

> **注**: 这是来自CDC的模拟数据集

---

## Slide 6: 未能评估的软件

### CDC清单内5项未能部署

| 软件 | 主要障碍 |
|:---|:---|
| **CZID (IDseq)** | 云服务为主，本地miniwdl集群适配不足 |
| **SURPI+** | 容器需sudo，与Apptainer安全策略冲突 |
| **DHO Lab** | 容器sudo依赖，源码依赖链复杂 |
| **NAO MGS** | 容器sudo依赖，源码依赖链复杂 |
| **TaxTriage** | 容器sudo依赖，源码依赖链复杂 |

**共性原因**: 容器化部署需sudo权限，不符合HPC最小权限原则

---

## Slide 7: 工具分类与策略

### 四种分析策略

1. **Reads直接分类**
   - taxprofiler (Kraken2/Bracken)
   - CLARK, GOTTCHA2

2. **组装后Contig分类**
   - KrakenMetaReads-nf
   - nf-core/mag

3. **同源性证据链**
   - rvdb-viral (DIAMOND/RVDB)

4. **病毒特征/共识筛选**
   - MLMVD-nf (多工具共识)

---

## Slide 8: nf-core/taxprofiler

### 多分类器并行流程

**定位**: 广泛筛查 + 快速概览

**核心特征**:
- Nextflow + nf-core最佳实践
- 支持多种分类器（Kraken2, MetaPhlAn, Kaiju等）
- 自动适配短/长读长

**读长兼容性**: ✅ 完全兼容

**使用建议**: 
- 广泛筛查 → 优先使用
- 高置信度清单 → 需施加共识/阈值策略

---

## Slide 9: GOTTCHA2

### 高特异性签名分类

**定位**: 基于唯一签名片段的高特异性分类

**核心思想**: 只在命中物种特异区域时才报告

**读长兼容性**: ✅ 兼容（Minimap2对长读长友好）

**优势**: 极低假阳性率

**局限**: 对极低丰度、数据库缺失目标可能漏检

**使用建议**: 作为"二次确证"工具

---

## Slide 10: sourmash

### MinHash快速检索

**定位**: 快速相似性/包含度判断

**优势**: 
- 极快、资源轻
- 适合大规模检索

**读长兼容性**: ✅ 兼容（但错误率影响k-mer匹配）

**使用建议**: 
- 覆盖度/一致性验证
- 长读长需纠错或作为"粗验证"

---

## Slide 11: CLARK

### 判别性k-mer分类

**定位**: 仅使用能唯一区分物种的k-mer

**变体**: CLARK (标准), CLARK-S (spaced seeds), CLARK-l (轻量)

**优势**: 速度快，特异性好

**风险**: 
- 对数据库覆盖依赖强
- 长读长错误影响精确k-mer

**使用建议**: 长读长推荐CLARK-S，需充足内存

---

## Slide 12: nf-core/mag

### 宏基因组组装与分箱

**定位**: 重建基因组（不以检出为目标）

**核心价值**: 产出可用于进化/功能分析的contig、bin、MAG

**读长兼容性**: 
- ✅ 短读长完全兼容
- ✅ 混合组装友好
- ⚠️ 纯长读长组装策略非最优

**适用场景**: 需要高质量基因组重建的分析

---

## Slide 13: rvdb-viral-metagenome-nf

### 病毒发现型流程

**定位**: 组装 + RVDB同源性搜索 + 病毒特征验证

**核心目标**: 提高环境病毒/远缘病毒发现能力

**优势**: 
- RVDB数据库针对病毒优化
- 蛋白水平搜索发现远缘序列
- 特别适合NCLDV等大病毒

**读长兼容性**: ✅ 兼容（长读长更利于大病毒重建）

---

## Slide 14: MLMVD-nf & KrakenMetaReads-nf

### MLMVD-nf: 多工具共识筛选

**定位**: 严格筛选器（牺牲灵敏度换特异性）

**策略**: VirSorter2 + DeepVirFinder + viralFlye 投票

**输出**: 更小但更可靠的候选集

### KrakenMetaReads-nf: 先组装后分类

**定位**: 利用长contig降低分类歧义

**优势**: 特别适合巨型病毒/大基因组片段定位

**风险**: 低丰度类群可能在组装阶段丢失

---

## Slide 15: 实测结果 - taxprofiler

### 短读长样本关键观察

**优势**:
- 广谱检出，形成"长尾分布"
- 能捕捉大量低丰度信号

**风险点**:
- "reads < 10"类群受数据库偏差、污染影响大
- 必须配合阈值与覆盖度证据

**结论**: 适合初步筛查，需后续验证

---

## Slide 16: 实测结果 - 组装策略对比

### MEGAHIT vs SPAdes

**SPAdes优势**:
- 产生更连续的病毒contig
- 利于后续证据链构建

**MEGAHIT优势**:
- 更"广"，保留更多低丰度碎片

**共识策略**: 两组装器重叠的contig集合更稳健

### 长读长组装优势

- Flye/viralFlye可产生几十kb到百kb的contig
- 为NCLDV等大病毒提供强证据链

---

## Slide 17: 实测结果 - 发现型工具

### rvdb-viral关键观察

**一致性集合**: 双轨（组装/特征/同源性）重叠更可靠

**NCLDV线索**: 
- 长读长样本中大量Mimiviridae/Phycodnaviridae相关命中
- 结合长contig形成强证据链

### MLMVD-nf关键观察

**3-tool consensus**: 严格共识收敛到少量高置信度contig

**建议**: 视为"确证候选集生成器"，非"广谱检出器"

---

## Slide 18: 敏感性与特异性权衡

| 工具 | 默认敏感性 | 默认特异性 | 共识后特异性提升 |
|:---|:---:|:---:|:---:|
| **taxprofiler** | 高 | 中 | 高 |
| **GOTTCHA2** | 中-低 | 高 | 中 |
| **sourmash** | 中 | 中-高 | 中 |
| **CLARK** | 中 | 高 | 中 |
| **rvdb-viral** | 高 | 中 | 高 |
| **MLMVD-nf** | 低 | 极高 | - |
| **KrakenMetaReads-nf** | 中 | 中 | 中-高 |

**关键**: 默认输出与共识/阈值输出的差异

---

## Slide 19: 计算资源与工程成本

### 资源消耗分类

**CPU/时间密集型**:
- nf-core/mag
- rvdb-viral
- MLMVD-nf

**内存密集型**:
- Kraken2/CLARK（数据库索引）

**轻量级**:
- sourmash（sketch极小）

### 工程化成熟度

**高**: nf-core系列、Nextflow流程（批量、日志、断点续跑）

**中**: Standalone工具（适合点对点验证）

---

## Slide 20: 数据库是"隐形决定因素"

### 数据库选择影响

**RefSeq/标准库**:
- ❌ 往往低估环境病毒与噬菌体多样性

**RVDB**:
- ✅ 对病毒（尤其环境病毒与远缘序列）更友好
- ⚠️ 需警惕数据库注释偏差

**结论**: 数据库选择直接影响发现能力

---

## Slide 21: 假阳性控制策略

### 最小必需策略（强烈推荐）

1. **宿主去除**
   - 短读长: Bowtie2
   - 长读长: Minimap2

2. **阈值过滤**
   - 设定最低read count/相对丰度阈值

### 多证据链共识

**策略A**: 多工具共识（≥2工具支持）

**策略B**: 组装证据优先
- 要求中长contig (>5-10kb)
- 病毒hallmark genes
- DIAMOND/RVDB或VirSorter2/CheckV支持

---

## Slide 22: 决策矩阵（评分1-5）

| 维度 | taxprofiler | rvdb-viral | MLMVD-nf | nf-core/mag | GOTTCHA2 | CLARK | sourmash | KrakenMetaReads |
|:---|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| **已知病毒敏感性** | 5 | 4 | 2 | 2 | 3 | 3 | 3 | 3 |
| **远缘病毒发现** | 3 | 5 | 3 | 4 | 1 | 1 | 2 | 3 |
| **特异性** | 3 | 3 | 5 | 4 | 5 | 4 | 4 | 3 |
| **结果可靠性** | 4 | 4 | 4 | 5 | 4 | 3 | 4 | 4 |
| **分析速度** | 3 | 1 | 2 | 1 | 4 | 5 | 5 | 3 |
| **内存效率** | 2 | 3 | 3 | 2 | 4 | 2 | 5 | 2 |
| **基因组重建** | 1 | 5 | 2 | 5 | 1 | 1 | 1 | 4 |
| **工程化成熟度** | 5 | 5 | 4 | 5 | 3 | 3 | 4 | 5 |

---

## Slide 23: 推荐方案一

### 高置信度共识与基准分析

**工具组合**: 
- taxprofiler（主筛查）
- GOTTCHA2 / sourmash / 组装证据（重点靶标确证）

**工作流程**:
1. taxprofiler广谱检出 + 快速概览
2. 宿主去除 + 阈值 + 覆盖度验证
3. GOTTCHA2签名覆盖确证

**适用场景**: 
- 废水环境病毒监测
- 临床前筛查项目

---

## Slide 24: 推荐方案二 & 三

### 方案二: 新发/暴发病原体发现

**工具组合**: 
rvdb-viral（发现） → MLMVD-nf（严格筛选） → nf-core/mag（深度重建）

**适用**: 环境未知病毒调查、暴发溯源

### 方案三: 废水病毒监测

**工具组合**: 
taxprofiler（批量扫盲） → GOTTCHA2（确证） → KrakenMetaReads-nf/rvdb-viral（组装验证）

**关键**: 多证据链 + 覆盖度阈值 + 二次确证

**输出**: 区分"筛查阳性"与"确证阳性"

---

## Slide 25: 最终建议与结论

### 核心建议

1. **部署可复现性是前提**
   - 不能稳定运行的工具不进入公共卫生决策链

2. **永远不用单一read count作为存在性结论**
   - 必须用覆盖度/组装/多工具一致性

3. **建立证据分层标签**
   - Screen-positive / Supportive / Confirmed

### 关键结论

- ✅ 没有单一工具能满足所有需求
- ✅ 需要分层策略：快速筛查 → 确证 → 深度分析
- ✅ 可部署性是工具选型的关键门槛
- ✅ 多证据链共识是降低假阳性的关键

---

## Slide 26: 致谢与联系方式

### 感谢

**CDC国家废水监测系统（NWSS）技术审查委员会**

### 联系方式

**Sihua Peng**  
UGA Sapelo2 HPC Cluster

### 报告获取

完整评估报告: `metagenome_viral_tool_assessment_rev5.md`

---

**演示结束，谢谢！**

